<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/static/img/favicon.ico" type="image/x-icon">
    <title>Azure OpenAI o1 Chat</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="/static/index.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/layout.css">

    <!-- Libraries -->
    <script src="/static/lib/markdown-it.min.js"></script>
    <script>
        // Configuration handled in config.js module
    </script>
    <script src="/static/lib/purify.min.js"></script>

    <!-- Favicon and touch icons -->
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/img/apple-touch-icon.png">
    <link rel="manifest" href="/static/site.webmanifest">

    <!-- Core Modules -->
    <script type="module" src="/static/js/session.js"></script>
    <script type="module" src="/static/js/config.js"></script>
    <script type="module" src="/static/js/utils/helpers.js"></script>
    <script type="module" src="/static/js/ui/markdownParser.js"></script>
    <script type="module" src="/static/js/ui/notificationManager.js"></script>
    <script type="module" src="/static/js/ui/displayManager.js"></script>
    <script type="module" src="/static/js/fileManager.js"></script>
    <script type="module" src="/static/js/messageHandler.js"></script>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <main class="chat-container">
        <header class="chat-header">
            <h1>Azure OpenAI o1 Chat</h1>
            <div class="model-info">
                <p><strong>Model Info:</strong> Using Azure OpenAI o1 model (no streaming)</p>
            </div>
        </header>

        <div class="chat-main">
            <!-- Chat History -->
            <section class="chat-history" id="chat-history" role="log" aria-live="polite">
                <!-- Messages injected via JavaScript -->
            </section>

            <!-- Input Area -->
            <section class="input-section">
                <div class="input-container">
                    <textarea id="user-input" 
                              placeholder="Type your message..."
                              aria-label="Your message"
                              rows="3"></textarea>
                    <button id="send-button" class="primary-button">
                        <span aria-hidden="true">‚Üë</span>
                        <span class="sr-only">Send message</span>
                    </button>
                </div>
                
                <!-- Token Usage -->
                <div class="token-usage-compact">
                    <h2 class="stats-heading">Token Usage</h2>
                    <div class="token-usage-grid">
                        <div class="stat-item">
                            <span class="stat-label">Prompt</span>
                            <span id="prompt-tokens" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Completion</span>
                            <span id="completion-tokens" class="stat-value">0</span>
                        </div>
                        <div class="stat-item highlight">
                            <span class="stat-label">Total</span>
                            <span id="total-tokens" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Reasoning</span>
                            <span id="reasoning-tokens" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Base Completion</span>
                            <span id="base-completion-tokens" class="stat-value">0</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="tabs" role="tablist">
                <button class="tab-button active" 
                        id="config-tab"
                        role="tab" 
                        data-target-tab="config-content"
                        aria-selected="true"
                        aria-controls="config-content">
                    Configuration
                </button>
                <button class="tab-button"
                        id="files-tab"
                        data-target-tab="files-content"
                        role="tab"
                        aria-selected="false"
                        aria-controls="files-content">
                    Files &amp; Context
                </button>
            </div>

            <!-- Configuration Panel -->
            <div id="config-content" class="tab-content active" role="tabpanel">
                <div class="config-section">
                    <label for="model-selector">AI Model:</label>
                    <select id="model-selector" class="config-select">
                        <option value="deepseek-r1" selected>DeepSeek-R1 (General Purpose)</option>
                        <option value="o1">Azure o1 (Advanced Reasoning)</option>
                    </select>
                </div>

                <div class="config-section">
                    <label for="developer-config">Assistant Settings:</label>
                    <input type="text" 
                           id="developer-config"
                           value="Formatting re-enabled - use markdown code blocks"
                           aria-describedby="config-help">
                    <p id="config-help" class="help-text">
                        Customize the assistant's response format
                    </p>
                </div>

                <div class="config-section" id="reasoning-controls">
                    <label for="reasoning-effort-slider">
                        Reasoning Effort: 
                        <span id="reasoning-effort-display">Medium</span>
                    </label>
                    <input type="range" 
                           id="reasoning-effort-slider"
                           min="1" 
                           max="3" 
                           value="2"
                           aria-valuetext="Medium">
                    <div class="effort-description">
                        <p id="effort-description-text">
                            Medium: Balanced processing time (1-3min) and quality
                        </p>
                    </div>
                </div>

                <div class="config-section" id="streaming-toggle">
                    <label>
                        <input type="checkbox" id="enable-streaming"> Enable Streaming
                    </label>
                </div>

            </div>

            <!-- Files Panel -->
            <div id="files-content" class="tab-content" role="tabpanel" aria-hidden="true">
                <div class="file-upload-area" id="drop-zone" tabindex="0" role="button">
                    <div class="upload-prompt">
                        <i class="upload-icon" aria-hidden="true">üìÅ</i>
                        <p>Drop files or click to upload<br>
                           <span class="file-limit">(Max 512MB)</span>
                        </p>
                        <input type="file" 
                               id="file-input" 
                               accept=".txt,.md,.json,.js,.py,.html,.css,.pdf,.docx,.doc" 
                               multiple 
                               hidden>
                    </div>
                </div>
                
                <!-- File Upload Status -->
                <div id="file-upload-status" class="file-upload-status">
                    <div class="upload-loading">
                        <div class="loading-spinner"></div>
                        <span class="loading-text">Processing files...</span>
                    </div>
                </div>
                
                <!-- File Selection Controls -->
                <div class="file-controls">
                    <div class="file-selection-wrapper">
                        <span id="file-selection-status" class="file-selection-status">No files selected</span>
                        <button id="select-all-files" class="select-all-button">Select All</button>
                    </div>
                    
                    <!-- Azure File Search Toggle -->
                    <div class="file-search-toggle">
                        <input type="checkbox" id="use-file-search" class="toggle-input">
                        <label for="use-file-search" class="toggle-label">Use Azure Search</label>
                        <span class="help-tooltip" title="Process files with Azure OpenAI for semantic search capability">‚ìò</span>
                    </div>
                </div>
                
                <!-- File List -->
                <div class="file-list-header">
                    <h3>Uploaded Files</h3>
                    <span class="file-help-text">Click on files to select them as context</span>
                </div>
                <div class="file-list" id="file-list"></div>
                
                <div class="file-stats">
                    <h3>Context Statistics</h3>
                    <dl>
                        <dt>Files:</dt>
                        <dd id="total-files">0</dd>
                        <dt>Total Size:</dt>
                        <dd id="total-size">0</dd>
                        <dt>Estimated Tokens:</dt>
                        <dd id="estimated-tokens">0</dd>
                    </dl>
                </div>
            </div>
        </aside>

        <!-- Mobile Tab Toggle -->
        <button class="mobile-tab-toggle" aria-label="Open context panel">
            <span class="tab-icon">üìÅ</span>
        </button>

        <!-- Theme Toggle -->
        <button class="theme-toggle" aria-label="Toggle theme">
            <span class="theme-icon">üåì</span>
        </button>
    </main>

    <!-- Error Display -->
    <div id="error-display" class="error-message"></div>

    <!-- Initialization -->
    <script type="module" src="/static/js/init.js"></script>
</body>
</html>
